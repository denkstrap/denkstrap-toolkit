<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/validation/formValidation/behaviour.js | validation-service</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A validation service to run form inputs against validators."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="validation-service"><meta property="twitter:description" content="A validation service to run form inputs against validators."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cache">cache</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/cache/cache.service.js~Cache.html">Cache</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validation">validation</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/validation.service.dom.js~ValidationServiceDom.html">ValidationServiceDom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/validation.service.js~ValidationService.html">ValidationService</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validation-formvalidation">validation/formValidation</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/formValidation/behaviour.js~Behaviour.html">Behaviour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/formValidation/cache.js~Cache.html">Cache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/formValidation/feedbackDisplay.js~FeedbackDisplay.html">FeedbackDisplay</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/formValidation/formValidation.js~FormValidation.html">FormValidation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/validation/formValidation/resolver.js~Resolver.html">Resolver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-condition">condition</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-eventDispatch">eventDispatch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getValidationFields">getValidationFields</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validation-formvalidation-validators">validation/formValidation/validators</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-email">email</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-required">required</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/validation/formValidation/behaviour.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import getValidationFields from &apos;./getValidationFields&apos;;

/**
 * The behaviour function provides cases for to trigger validations.
 * Handlers are stored to consider dynamic dom manipulating.
 */
export class Behaviour {

    /**
     *
     * @param {String} formId - The id of the form.
     * @param {String} validationAttr
     * @param {Function} condition - The condition for to collect the validating fields
     * @param {Object} configFields - The config of fields
     * @param {Object} validation  - The validation service object
     */
    constructor( formId, validationAttr, condition, configFields, validation ) {

        if ( typeof formId !== &apos;string&apos; ) {
            throw new TypeError( &apos;form id must be of type String&apos; );
        }

        if ( typeof validationAttr !== &apos;string&apos; ) {
            throw new TypeError( &apos;validationAttr must be of type String&apos; );
        }

        if ( typeof condition !== &apos;function&apos; ) {
            throw new TypeError( &apos;formId must be of type function&apos; );
        }

        if ( typeof configFields !== &apos;object&apos; ) {
            throw new TypeError( &apos;configFields must be of type function&apos; );
        }

        if ( typeof validation !== &apos;object&apos; ) {
            throw new TypeError( &apos;validation must be of type object&apos; );
        }

        /**
         *
         * @type {String}
         */
        this.formId = formId;

        /**
         * @type {String}
         */
        this.validationAttr = validationAttr;

        /**
         *
         * @type {Function}
         */
        this.condition = condition;
        /**
         * @type{Object} validation
         */
        this.validation = validation;
        /**
         *
         * @type {Object} configFields
         */
        this.configFields = configFields;

        /**
         * @type {Object} The field event handlers are stored in this object ({@link behaviour}).
         */
        this.behaviourHandler = {};
    }

    /**
     * Updates the configFields property
     * @param {configFields} configFields - The config of fields
     * @param {Object} validation - The validation service object
     */
    updateConfigFieldsAndValidation( configFields, validation ) {
        this.configFields = configFields;
        this.validation = validation;
    }

    /**
     * The behaviour for each field
     */
    behaviour() {
        var fields = getValidationFields( this.formId, this.validationAttr, this.condition );
        Array.prototype.forEach.call( fields, function( field ) {
            var type = field.getAttribute( &apos;type&apos; );
            var tagName = field.tagName.toLowerCase();
            var eventName = type !== &apos;checkbox&apos; &amp;&amp; type !== &apos;radio&apos; &amp;&amp; tagName !== &apos;select&apos; ? &apos;blur&apos; : &apos;change&apos;;

            if ( typeof this.behaviourHandler[ field.id ] !== &apos;undefined&apos; ) {
                field.removeEventListener( eventName, this.behaviourHandler[ field.id ] );
            }

            /**
             * Creates field event handler
             */
            var handler = function() {
                var fieldIdentifier = field.id;
                this.validation.setValueByField( field );
                this.validation.validate( fieldIdentifier, this.formId ).catch( function() {} );
                if ( this.configFields[ fieldIdentifier ].behaviourGroupSel !== null ) {

                    fields = document.querySelectorAll( this.configFields[ fieldIdentifier ].behaviourGroupSel );
                    Array.prototype.forEach.call( fields, function( field ) {

                        var fieldIdentifierGroupMember = field.id;
                        if ( fieldIdentifierGroupMember !== fieldIdentifier ) {
                            this.validation.setValueByField( field );
                            this.validation.validate( fieldIdentifierGroupMember, this.formId )
                                .catch( function() {} );
                        }
                    }.bind( this ) );

                }
            }.bind( this );

            this.behaviourHandler[ field.id ] = handler;
            field.addEventListener( eventName,  handler );
        }.bind( this ) );
    }
}

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
